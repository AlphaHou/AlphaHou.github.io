---
layout:     post
title:      reading-note-csapp
date:       2018-03-16 21:48:00
author:     "Hou"
header-img: "img/post-bg-computer-science.jpg"
tags:
    - note
    - csapp
---
第十一章-网络编程小结
============

### 11.1 客户端-服务器编程模型

每个网络应用都是基于客户端-服务器模型的。采用这个模型，一个应用是有一个服务器进程和一个或者多个客户端进程组成的。服务器管理某种资源，并且通过操作这种资源来为它的客户端提供某种服务。

客户端-服务器模型中的基本操作是事务（transaction）


### 11.2 网络

物理上而言，网络是一个按照地理远近组成的层次系统。最低层是LAN（Local Area Network，局域网），在一个建筑或者校园范围内。迄今为止，最流行的局域网技术是以太网（Ethernet）。

一个以太网段（Ethernet segment）包括一些电缆（通常是双绞线）和一个叫做集线器的小盒子。以太网短通常跨越一些小的区域，例如某建筑物的一个房间或者一个楼层。每根电缆都有相同的最大位带宽，通常是100Mb/s或者1Gb/s。一端连接到主机的适配器，而另一端则连接到集线器的一个端口上。集线器不加分辨的讲从一个端口上收到的每个位复制到其他所有的端口上。因此每台主机都能看到每个位。

![](/img/post/post-2018-02-28-47.jpg)

每个以太网适配器都有一个全球唯一的48位地址，它存储在这个适配器的非易失性存储器上。一台主机可以发送一段位（称为帧（frame））到这个网段内的其他任何主机。每个帧包括一些固定数量的头部（header）位，用来标识此帧的源和目的地址以及此帧的长度，此后紧随的就是数据位的有效载荷（payload）。每个主机适配器都能看到这个帧，但是只有目的主机实际读取他。

使用一些电缆和叫做网桥（bridge）的小盒子，多个以太网段可以连接成较大的局域网，成为桥接以太网（bridged Ethernet）。桥接以太网能够跨越整个建筑物或者校区。在一个桥接以太网里，一些电缆连接网桥与网桥，而另外一些连接网桥和集线器。这些电缆的带宽可以是不同的。

![](/img/post/post-2018-02-28-48.jpg)

在层次的更高级别中，多个不兼容的局域网可以通过叫做路由器（router）的特殊计算机连接起来，组成一个internet（互联网络）。每台路由器对于它所连接到的每个网络都有一个适配器（端口）。路由器也能连接高速点到点电话连接，这是称为WAN（Wide-Area Network，广域网）

![](/img/post/post-2018-02-28-49.jpg)

一层运行在每台主机和路由器上的协议软件消除了不同网络之间的差异。协议必须提供两种基本能力：

- 命名机制。不同的局域网技术有不同和不兼容的方式来为主机分配地址。互联网络协议通过定义一种一直的主机地址格式消除了这些差异。每台主机会被分配至少一个这种互联网络地址（internet address），这个地址唯一的标识了这台主机。

- 传送机制。在电缆上编码位和将这些位封装成帧方面，不同的联网技术有不同的和不兼容的方式。互联网络协议通过定义一种把数据位捆扎成不连续的片（成为包）的统一方式，从而消除了这些差异。一个包是由包头和有效载荷组成的。

![](/img/post/post-2018-02-28-50.jpg)


### 11.3 全球IP因特网

![](/img/post/post-2018-02-28-51.jpg)

TCP/IP（Transmission Control Protocol/Internet Protocol）是一个协议族。IP协议提供基本的命名方法和递送机制，这种机制能够从一台因特网主机往其他主机发送包，也叫作数据报（datagram）。IP机制从某种意义上是不可靠的，因为如果数据报在网络中丢失或者重复，它并不会试图恢复。UDP（Unreliable Datagram Protocol，不可靠数据报协议）稍微扩展了IP协议，这样一来，包可以在进程间而不是在主机间传送。TCP是一个构建在IP之上的复杂协议，提供了进程间可靠地双向连接。

- 主机集合被映射为一组32位的IP地址。

- 这组IP地址被映射为一组成为因特网域名（Internet domain name）的标识符。

- 因特网主机上的进程能够通过连接和任何其他因特网主机上的进程通信。

*11.3.1 IP地址*

IP地址通常是以一种称为点分十进制表示法来表示的，这里每个字节由它的十进制值表示，冰球用句点和其他字节间分开

*11.3.2 因特网域名*

![](/img/post/post-2018-02-28-52.jpg)

1988年之后，由域名到IP地址的映射通过分布世界范围的数据库DNS（DOmain Name System）来维护的。从概念上而言，DNS数据库由上百万的主机条目结构（host entry structure）组成，其中每条定义了一组域名和一组IP地址之间的映射。从数学意义上讲，可以认为每条主机条目就是一个域名和IP地址的等价类。

*11.3.3 因特网连接*

一个套接字是连接的一个端点。每个套接字都有相应的套接字地址，是由一个因特网地址和一个16位的整数端口组成的，用“地址：端口”来表示。

当客户端发起一个连接请求时，客户端套接字地址中的端口是由内核自动分配的，称为临时端口（ephemeral port）。然而，服务器套接字地址中的端口通常是某个知名端口，适合这个服务相对于的。例如Web服务器通常使用端口80，电子邮件服务器使用端口25。每个具有知名端口的服务都有一个对于的知名服务名。例如Wewb服务的知名名字是http，email的知名名字是smtp。

一个连接是由它两端的套接字地址唯一确定的。这对套接字地址叫做套接字对。

![](/img/post/post-2018-02-28-53.jpg)


### 11.4 套接字接口

套接字接口（socket interface）是一组函数，它们和Unix I/O函数结合起来，用以创建网络应用。

![](/img/post/post-2018-02-28-54.jpg)

*11.4.1 套接字地址结构*

从Linux内核的角度来看，一个套接字就是通信的一个端点。从Linux程序的角度来看，套接字就是一个有相应描述符的打开文件。


### 11.5 Web服务器

*11.5.1 Web基础*

Web客户端和服务器之间的交互用的是一个基于文本的应用级协议，叫做HTTP（Hypertext Transfer Protocol，超文本传输协议）。HTTP是一个简单的协议。一个Web客户端打开一个到服务器的因特网连接，冰球请求某些内容。服务器响应所请求的内容，然后关闭连接。浏览器读取这些内容，并把它显示在屏幕上。

Web服务和常规的文件检索服务（如FTP）的主要区别在于Web内容可以用一种叫做HTML（Hypertext Markup Language，超文本标记语言）的语言来编写。

*11.5.2 Web内容*

对于Web客户端和服务器而言，内容是与一个MIME（Multipurpose Internet Mail Extensions，多用途的网际邮件扩充协议）类型相关的字节序列。

每条由Web服务器返回的内容都是和它管理的某个文件相关联的。这些文件中的每一个都有一个唯一的名字，佳作URL（Universal Resource Locator，通用资源定位符）。可执行文件的URL可以在文件名后包括程序参数。“？”字符分割文件名和参数，而且每个参数都用“&”字符分隔开。

*11.5.3 HTTP事物*

1. HTTP请求

一个HTTP请求的组成是这样的：一个请求行（request line），后面跟随零个或更多个请求报头（request header），再跟随一个空的文本行来重视报头列表。一个请求行的形式是

method URI version

GET方法指导服务器生成和返回URI（Uniform Resource Identifier，统一资源标识符）标识的内容。URI是相应的URL的后缀，包括文件名和可选的参数。

请求报头为服务器提供了额外的信息，例如浏览器的商标名，或者浏览器理解的MIME类型。请求报头的格式为

header-name：header-data

代理缓存（proxy cache）会使用Host报头，这个代理缓存有时作为浏览器和管理被请求文件的原始服务器（origin server）的中介。客户端和原始服务器之间，可以有多个代理，即所谓的代理链（proxy chain）。Host报头中的数据指示了原始服务器的域名，使得代理链中的代理能够判断它是否可以再本地缓存中拥有一个被请求内容的副本。

2. HTTP响应

一个HTTP响应的组成是这样的：一个响应行（response line），后面跟随零个或更多的响应报头（response header），在跟随一个终止报头的空行，再跟随一个响应主题（response body）。一个响应行的格式是

version status-code status-message

version字段描述的是响应所遵循的HTTP版本。状态码是一个三位的正整数，指明对请求的处理。状态消息给出与错误代码等价的英文描述。

响应报头提供了关于响应的附加信息，两个最重要的报头是Content-Type，它告诉客户端响应主体中内容的MIME类型；以及Contetnt-Length，用来指示响应主体的字节大小。

*11.5.4 服务动态内容*

在服务器接收一个如下的请求后

GET /cgi-bin/adder?15000&213 HTTP/1.1

它调用fork来创建一个子进程，并调用execve在子进程的上下文中执行/cgi-bin/adder程序。像adder这样的程序，常常被称为CGI（Common Gateway Interface）程序，因为它们遵守CGI标准的规则。在调用execve之前，子进程将CGI缓解变了QUERY_STRING设置为“15000&213”，adder程序在运行时可以用Linux getenv函数来引用它。

