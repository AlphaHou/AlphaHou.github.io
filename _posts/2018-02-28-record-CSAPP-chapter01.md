---
layout:     post
title:      reading-note-csapp
date:       2018-02-28 22:48:00
author:     "Hou"
header-img: "img/post-bg-computer-science.jpg"
tags:
    - note
---
第一章-漫游计算机系统小结
============


### 1.1 信息就是位+上下文

源程序是由值0和1组成的位（比特）序列，8个位被组织成一组，称为字节。每个字节表示程序中的某些文本字符。大部分的现代计算机系统都使用ASCII标准来表示文本字符（用唯一的单字节大小的整数值来表示每个字符，如字母A用65来表示）。

由ASCII字符构成的文件称为文本文件，所有其他文件都称为二进制文件。系统中所有的信息都是由一串比特表示的。区分不同数据对象的唯一方法是这些数据对象的上下文。


### 1.2 程序被其他程序翻译成不同的风格

高级语言程序中的每条语句都必须被其他程序转化为一系列的低级机器语言指令。然后这些指令按照一种称为可执行目标程序的格式打包好，并以二进制磁盘文件的形式存放起来。目标程序也成为可执行目标文件。

这个翻译过程可分为四个阶段（以c语言为例）：

1. 预处理阶段。预处理器（cpp）根据以字符#开头的命令，修改原始的C程序。

2. 编译阶段。编译器（ccl）将文本文件hello.i翻译成hello.s。它包含一个汇编语言程序。（将文本格式的命令翻译为低级机器语言指令）

3. 汇编阶段。汇编器（as）将hello.s翻译成机器语言指令，把这些指令打包成一种叫做可重定位目标程序的格式，并将结果保存在目标文件hello.o（一个二进制文件）中。

4. 链接阶段。链接器（ld）将在程序中被调用的标准库函数合并到程序中，得到hello（可执行目标文件），可以被加载到内存中，由系统执行。


### 1.3 了解编译系统如何工作是大有益处的

优化程序性能（了解不同的语句是如何被编译的，从而选择合适的实现方式）、理解链接是出现的错误、避免安全漏洞（缓冲区溢出错误）


### 1.4 处理器读并解释储存在内存中的指令

*1.4.1 系统的硬件组成*

1. 总线，贯穿整个系统的是一组电子管道，负责在各个部件间传递信息字节。通常总线被设计成传送定长的字节块（字长是一个基本的系统参数，4个字节为32位，8个字节为64位），也就是字（word）。

2. I/O设备，是系统与外部世界的联系通道。每个I/O设备都通过一个控制器或适配器与I/O总线相连。控制器与适配器的区别主要在于他们的封装方式。控制器是I/O设备本身或者系统的主印制电路板（主板）上的芯片组。而适配器则是一块插在主板插槽上的卡。无论如何，它们的功能都是在I/O总线和I/O设备之间传递信息。

3. 主存，是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。从屋里上来说，主存是由一组动态随机存取存储器（DRAM）芯片组成的。从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引），这些地址都是从零开始的。

4. 处理器，中央处理单元（CPU），是解释（或执行）存储在贮存中指令的引擎。处理器的核心是一个大小为一个字的存储设备（或寄存器），称为程序计数器（PC）。在任何时刻，PC都指向贮存中的某条机器语言指令（即含有该条指令的地址）。处理器读取被指向的指令，解释指令中的位，执行该指令知识的简单操作，然后更新PC，使其指向下一条指令，而这条指令并不一定和在内存中刚刚执行的指令相邻。这些简单操作围绕着主存、寄存器文件（register file）和算术/逻辑单元（ALU，计算新的数据和地址值）进行。以下是一些例子：

- 加载：从主存复制一个自己或者一个字到寄存器，以覆盖寄存器原来的内容。
- 存储：从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来的内容。
- 操作：把两个寄存器的内容复制到ALU，ALU对这两个字做算术运算，并将结果存放到一个寄存器中，以覆盖该寄存器中原来的内容。
- 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖PC中原来的值。


### 1.4.2 运行hello程序

![](/img/post/post-2018-02-28-01.jpg)
![](/img/post/post-2018-02-28-02.jpg)
![](/img/post/post-2018-02-28-03.jpg)


### 1.5 高速缓存至关重要

观察上述操作我们能发现，复制占了开销的很大一部分，因此加快复制操作很重要。根据机械原理，存储设备的大小与运行速度成反比，因此处理器从寄存器文件中度数据比从主存中读取几乎要快100倍。而随着半导体技术的进步，这种处理器与主存之间的差距还在持续增大。加快处理器的运行速度比加快主存的运行速度要容易和便宜得多。

解决的方法是采用更小更快的存储设备，称为高速缓存存储器（cache memory，简称为cache），作为暂时的集结区域。


### 1.6 存储设备形成层次结构

![](/img/post/post-2018-02-28-04.jpg)


### 1.7 操作系统管理硬件

操作系统由两个基本功能：

1. 防止硬件被失控的应用程序滥用。

2. 向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。

操作系统通过几个基本的抽象概念（进程、虚拟内存和文件）来实现这两个功能。操作系统通过几个基本的抽象概念，文件（I/O设备的抽象表示）、虚拟内存（主存和磁盘I/O设备的抽象表示）、进程（处理器、主存和I/O设备的抽象表示）


*1.7.1 进程*

进程是操作系统对一个正在运行的程序的一种抽象。在一个系统上可以同时运行多个进程，而每个进程都好像在独占地使用硬件。而并发运行，则是说一个进程的指令和另一个进程的指令是交错执行的。在大多数系统中，需要运行的进程数是多于可以运行它们的CPU个数的。无论是在单核还是多核系统中，一个CPU看上去都像是在并发地执行多个进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为上下文切换。

操作系统保持跟踪进程运行所需的所有状态信息。这种状态，也就是上下文，包括许多信息，比如PC和寄存器文件的当前值，以及主存的内容。在任何一个时刻，单处理器系统都只能执行一个进程的代码。当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换，即保存当前进程的上下文、恢复新进程的上下文，然后将控制权传递到新进程。新进程就会从它上次停止的地方开始。

*1.7.2 线程*

一个进程由多个线程组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。由于网络服务器中对并行处理的需求，线程称为越来越重要的编程模型，因为多线程之间比多进程之间更容易共享数据。

*1.7.3 虚拟内存*

虚拟内存是一个抽象概念，它为每个进程提供一个假象，即每个进程都在独占地使用主存。每个进程看到的内存都是一致的，称为虚拟地址空间。

![](/img/post/post-2018-02-28-05.jpg)

- 程序代码和数据。对所有的进程来说，代码是从同一固定地址开始，紧接着的适合C全局变量相对应的数据位置。

- 堆。代码和数据区后紧随着的运行是堆。代码和数据区在进程一开始运行时就被指定了大小，与此不同，当调用像malloc和free这一的C标准库函数时，堆可以在运行时动态地扩展和收缩。

- 共享库。大约在地址空间的中间部分是一块用来存放像C标准库和数学库这样的共享库的代码和数据的区域。

- 栈。位于用户虚拟地址空间顶部的用户栈，编译器用它来实现函数调用。和堆一样，用户栈在程序执行期间可以动态地扩展和收缩。特别地，每次我们调用一个函数时，栈就会增长；从一个函数返回时，栈就会收缩。

- 内核虚拟内存。地址空间顶部的区域是为内核保留的。不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数。相反，它们必须调用内核来执行这些操作。


*1.7.4 文件*

文件就是字节序咧，每个I/O设备，包括磁盘、键盘、显示器，甚至网络，都可以看成是文件。


### 1.8 系统之间利用网络通信

从一个单独的系统来看，网络可视为一个I/O设备。


### 1.9 重要主题

*1.9.1 Amdahl定律*

该定理由Genen Amdahl提出，计算机领域的早期先锋之一，主要思想是，当我们堆系统的某个部分加速时，其对系统整体性能的影响取决于该部分的重要性和加速程度。（这定律真的太傻逼了）

*1.9.2 并发和并行*

并发（concurrency）是一个通用的概念，指一个同时具有多个活动的系统；而并行（parallelism）指的是用并发来使一个系统运行得更快。按照系统层次结构中由高到低的顺序重点强调三个运用并行的抽象层次：

1. 线程级并发。超线程，是一项允许一个CPU执行多个控制流的技术。常规处理器需要大约20000个时钟周期做不同线程间的转换，而超线程的处理器可以在单个周期的基础上决定要执行哪一个线程。多处理器的使用首先减少了执行多个任务时模拟并发的需要，其次，它可以使应用程序运行得更快（要求程序是以多线程方式来书写的）

2. 指令级并行。现代处理器可以同时执行多条指令的属性称为指令级并行。

3. 单指令、多数据并行。许多现代处理器拥有特殊的硬件，允许一条指令产生多个可以并行执行的操作，这种方式称为单指令、多数据，即SIMD并行。

*1.9.3 计算机系统中抽象的重要性*

![](/img/post/post-2018-02-28-06.jpg)